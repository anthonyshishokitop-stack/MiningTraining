<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Mining Safety Training</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { 
            background: #000 url('https://images.unsplash.com/photo-1581092580489-8e36c4f6d857?ixlib=rb-4.0.3&auto=format&fit=crop&q=80') center/cover no-repeat fixed; 
            color: #e0e0e0; 
            margin: 0; 
            font-family: 'Segoe UI', sans-serif; 
            overflow-x: hidden;
        }
        #main { 
            display: flex; 
            flex-direction: column;
            height: 100vh; 
        }
        #sidebar { 
            width: 100%;
            max-width: 420px;
            background: linear-gradient(180deg, #0a1a2f 0%, #000 100%); 
            padding: 20px;
            overflow-y: auto; 
            box-shadow: 0 8px 30px #000;
            border-bottom: 3px solid #00ddff;
            display: flex; 
            flex-direction: column; 
        }
        #logo h1 { 
            color: #00ddff; 
            text-shadow: 0 0 20px #00ddff; 
            font-size: clamp(24px, 5vw, 32px);
            margin: 0; 
            text-align: center; 
        }
        #logo small { 
            color: #00ffcc; 
            font-size: clamp(12px, 3vw, 16px);
            display: block; 
            margin-top: 8px; 
            text-align: center; 
        }
        .module-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 16px; 
            flex: 1; 
            margin: 20px 0; 
        }
        .module-btn { 
            background: linear-gradient(145deg, #0f1a2e, #1e293b); 
            border: 2px solid #00ddff; 
            color: #00ffcc; 
            padding: 15px 10px;
            border-radius: 16px; 
            font-weight: bold; 
            font-size: clamp(14px, 3vw, 15px);
            text-align: center; 
            box-shadow: 0 6px 20px rgba(0,255,200,0.2); 
            transition: all 0.3s; 
            min-height: 80px;
            display: flex; 
            align-items: center; 
            justify-content: center; 
            cursor: pointer; 
            touch-action: manipulation;
            position: relative;
        }
        .module-btn:hover { 
            transform: translateY(-6px); 
            box-shadow: 0 15px 40px rgba(0,255,200,0.5); 
            border-color: #00ffff; 
        }
        .module-advanced { 
            border-color: #ff6600 !important; 
        }
        .module-advanced:hover { 
            border-color: #ff9900 !important; 
        }
        .score-badge {
            position: absolute;
            top: -8px;
            right: -8px;
            background: #00ff88;
            color: #000;
            font-size: 12px;
            font-weight: bold;
            padding: 4px 8px;
            border-radius: 12px;
            box-shadow: 0 0 10px rgba(0,255,136,0.8);
            min-width: 50px;
            text-align: center;
        }
        .passed { background: #00ff88; }
        .failed { background: #ff0066; }
        #content { 
            flex: 1; 
            background: rgba(0,0,0,0.85); 
            display: flex; 
            flex-direction: column; 
            padding: 20px;
            overflow-y: auto; 
        }
        #moduleTitle { 
            color: #00ffcc; 
            font-size: clamp(24px, 6vw, 32px);
            font-weight: bold; 
            text-align: center; 
            margin-bottom: 30px; 
            text-shadow: 0 0 15px #00ffcc; 
        }
        .action-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            max-width: 1000px; 
            margin: 0 auto 40px; 
        }
        .action-card { 
            background: linear-gradient(135deg, #1a1a2e, #16213e); 
            border: 3px solid #00ddff; 
            border-radius: 20px; 
            padding: 30px 20px;
            text-align: center; 
            box-shadow: 0 10px 40px rgba(0,255,200,0.3); 
            transition: all 0.4s; 
            cursor: pointer; 
            min-height: 150px;
        }
        .action-card:hover { 
            transform: scale(1.08); 
            box-shadow: 0 20px 60px rgba(0,255,200,0.6); 
            border-color: #00ffff; 
        }
        .action-card h3 { 
            color: #00ffcc; 
            margin: 20px 0; 
            font-size: clamp(20px, 4vw, 26px);
        }
        .action-card .icon { 
            font-size: clamp(60px, 15vw, 90px);
            margin-bottom: 20px; 
        }
        #videoArea { 
            width: 100%; 
            height: 100%; 
            background: #000; 
            display: none; 
            align-items: center; 
            justify-content: center; 
        }
        #videoPlayer { 
            width: 100%;
            max-width: 95%; 
            height: auto;
            aspect-ratio: 16/9;
            border: 4px solid #00ddff; 
            border-radius: 16px; 
        }
        .info-box { 
            background: rgba(10,25,50,0.95); 
            padding: 15px;
            border-radius: 14px; 
            border: 2px solid #00ddff; 
            margin-top: auto; 
            text-align: center; 
            font-size: clamp(12px, 3vw, 15px);
        }
        #eventLog { 
            font-weight: bold; 
            margin-top: 10px; 
            color: #00ffcc; 
        }
        .quiz-panel { 
            background: rgba(20,30,50,0.98); 
            padding: 20px;
            border-radius: 20px; 
            border: 3px solid #ffd700; 
            max-width: 1000px; 
            margin: 20px auto;
            display: none; 
        }
        .quiz-question { 
            font-size: clamp(18px, 5vw, 24px);
            margin-bottom: 20px;
            color: #fff; 
            text-align: center; 
        }
        .quiz-options { 
            display: grid; 
            gap: 12px;
        }
        .quiz-btn { 
            background: #1e293b; 
            border: 2px solid #00ddff; 
            padding: 15px;
            border-radius: 14px; 
            font-size: clamp(16px, 4vw, 20px);
            transition: all 0.3s; 
            text-align: center; 
            cursor: pointer; 
            min-height: 60px;
        }
        .quiz-btn:hover { 
            background: #00ddff; 
            color: #000; 
            transform: scale(1.03); 
        }
        .quiz-btn:disabled { 
            opacity: 0.6; 
            cursor: not-allowed; 
        }
        .progress-bar {
            height: 20px;
            background: #1e293b;
            border-radius: 10px;
            overflow: hidden;
            margin: 20px 0;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #00ddff, #00ffcc);
            width: 0%;
            transition: width 0.8s ease;
        }
        .summary-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 30px 0;
        }
        .stat-card {
            background: rgba(10,25,50,0.9);
            padding: 15px;
            border-radius: 12px;
            text-align: center;
            border: 2px solid #00ddff;
        }
        .stat-value {
            font-size: 32px;
            font-weight: bold;
            color: #00ffcc;
        }
        .stat-label {
            font-size: 14px;
            color: #aaa;
        }

        @media (min-width: 768px) {
            #main { 
                flex-direction: row;
            }
            #sidebar { 
                width: 420px;
                height: 100vh;
                border-right: 3px solid #00ddff;
                border-bottom: none; 
                padding: 30px;
            }
            #content { 
                padding: 40px;
            }
            .action-grid { 
                gap: 40px;
            }
            .action-card { 
                padding: 50px 30px;
            }
            .info-box { 
                padding: 20px;
                font-size: 15px; 
            }
            .quiz-panel { 
                padding: 40px;
                margin: 40px auto; 
            }
            .quiz-question { 
                margin-bottom: 30px;
            }
            .quiz-options { 
                gap: 18px;
            }
            .quiz-btn { 
                padding: 20px;
            }
        }
    </style>
</head>
<body>

<div id="main">
    <div id="sidebar">
        <div id="logo">
            <h1>Mining Safety Training</h1>
            <small>Induction</small>
        </div>

        <div class="module-grid" id="moduleGrid">
            <!-- Modules will be injected with badges here -->
        </div>

        <div class="info-box">

            <strong>Completed Modules:</strong> <span id="completedCount">0</span>/18<br>
            <strong>Overall Pass Rate:</strong> <span id="overallPass">0%</span>
            <div id="eventLog"><strong>EVENT:</strong> Ready — Select a module</div>
        </div>
    </div>

    <div id="content">
        <div id="welcome" style="text-align:center; margin-top:80px;">
            <img src="https://internationalbanker.com/wp-content/uploads/2023/08/Mining.png" alt="Gold & Platinum Mining Operations" style="max-width:90%; height:auto; margin-bottom:30px; border-radius:15px; box-shadow:0 0 30px rgba(0,255,200,0.4);">
            <h1 style="font-size: clamp(30px, 8vw, 50px); color:#00ffcc; text-shadow:0 0 30px #00ffcc;">MINING SAFETY TRAINING</h1>
            <p style="font-size: clamp(18px, 5vw, 26px); margin-top:30px;">18 Critical Modules • Induction</p>
        </div>

        <div id="moduleView" style="display:none;">
            <h2 id="moduleTitle"></h2>
            <div class="action-grid">
                <div class="action-card" onclick="playVideo()">
                    <div class="icon">▶️</div>
                    <h3>WATCH TRAINING VIDEO</h3>
                </div>
                <div class="action-card" onclick="startTest()">
                    <div class="icon">✅</div>
                    <h3>TAKE TEST NOW</h3>
                </div>
            </div>
        </div>

        <div id="videoArea" style="display:none;">
            <iframe id="videoPlayer" src="" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
        </div>

        <div id="quizPanel" class="quiz-panel">
            <div class="quiz-question" id="qtext"></div>
            <div class="quiz-options" id="opts"></div>
            <div id="fb" class="mt-4 fs-5 fw-bold text-center"></div>
            <button id="nextQ" class="btn btn-success mt-4 w-100" style="display:none; padding:18px; font-size:20px;" onclick="nextQ()">Next Question</button>
        </div>

        <div id="result" class="text-center p-5 rounded d-none" style="background:rgba(0,0,0,0.9); max-width:900px; margin:40px auto;">
            <h2 id="resultText" style="font-size:36px; margin-bottom:20px;"></h2>
            
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            <p id="resultScore" style="font-size:32px; margin:20px 0;"></p>

            <div class="summary-stats">
                <div class="stat-card">
                    <div class="stat-value" id="timeTaken">0:00</div>
                    <div class="stat-label">Time Taken</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="questionsTotal">0</div>
                    <div class="stat-label">Total Questions</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="correctAnswers">0</div>
                    <div class="stat-label">Correct</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="accuracy">0%</div>
                    <div class="stat-label">Accuracy</div>
                </div>
            </div>

            <p id="passMessage" style="font-size:20px; margin:30px 0;"></p>
            
            <button class="btn btn-primary mt-3 me-2" onclick="backToModules()">Back to Modules</button>
            <button class="btn btn-outline-light mt-3" onclick="retakeTest()" id="retakeBtn">Retake Test</button>
        </div>
    </div>
</div>

<script>
// Video URLs, moduleNames, baseQuiz remain unchanged (same as previous version)


const videos = {
    handover: "https://www.youtube.com/embed/uqbDOIaEyHs?autoplay=1&controls=0&modestbranding=1&rel=0&iv_load_policy=3",
    lhd: "https://www.youtube.com/embed/HjnCR0pBlQs?autoplay=1&controls=0&modestbranding=1&rel=0&iv_load_policy=3",
    drill: "https://www.youtube.com/embed/rALo7h9pCwg?autoplay=1&controls=0&modestbranding=1&rel=0&iv_load_policy=3",
    support: "https://www.youtube.com/embed/CJ80Gbmes88?autoplay=1&controls=0&modestbranding=1&rel=0&iv_load_policy=3",
    vent: "https://www.youtube.com/embed/scULNpKA3ZU?autoplay=1&controls=0&modestbranding=1&rel=0&iv_load_policy=3",
    rockfall: "https://www.youtube.com/embed/RxyBImZyFb4?autoplay=1&controls=0&modestbranding=1&rel=0&iv_load_policy=3",
    traffic: "https://www.youtube.com/embed/bugO7N1AN0s?autoplay=1&controls=0&modestbranding=1&rel=0&iv_load_policy=3",
    reentry: "https://www.youtube.com/embed/G2Hs51QDszc?autoplay=1&controls=0&modestbranding=1&rel=0&iv_load_policy=3",
    shaft_sinking: "https://www.youtube.com/embed/dL0axVfO49s?autoplay=1&controls=0&modestbranding=1&rel=0&iv_load_policy=3",
    raise_drill: "https://www.youtube.com/embed/0h_Zi5BNUPA?autoplay=1&controls=0&modestbranding=1&rel=0&iv_load_policy=3",
    electrical: "https://www.youtube.com/embed/TMT6f3tZQSk?autoplay=1&controls=0&modestbranding=1&rel=0&iv_load_policy=3",
    mhsa: "https://www.youtube.com/embed/X1DvlkgY-Sc?autoplay=1&controls=0&modestbranding=1&rel=0&iv_load_policy=3",
    seismicity: "https://www.youtube.com/embed/geun1k07NkM?autoplay=1&controls=0&modestbranding=1&rel=0&iv_load_policy=3",
    blasting: "https://www.youtube.com/embed/G2Hs51QDszc?autoplay=1&controls=0&modestbranding=1&rel=0&iv_load_policy=3",
    evacuation: "https://www.youtube.com/embed/3aLWlDY_G9w?autoplay=1&controls=0&modestbranding=1&rel=0&iv_load_policy=3",
    fire: "https://www.youtube.com/embed/x414lRd1aak?autoplay=1&controls=0&modestbranding=1&rel=0&iv_load_policy=3",
    tmm: "https://www.youtube.com/embed/BYzg3G8gQYY?autoplay=1&controls=0&modestbranding=1&rel=0&iv_load_policy=3",
    winders: "https://www.youtube.com/embed/HkE7m1cdvBU?autoplay=1&controls=0&modestbranding=1&rel=0&iv_load_policy=3"



    
};

const moduleNames = {
    handover: "Shift Handover & Pre-Shift Checks",
    lhd: "LHD Tramming in Decline",
    drill: "Face Drilling (Jumbo)",
    support: "Install Mesh & Bolts",
    vent: "Main Ventilation Failure",
    rockfall: "Major Rock Fall Event",
    traffic: "Traffic Conflict in Single Lane",
    reentry: "Unsafe Re-Entry Attempt",
    shaft_sinking: "Shaft Sinking (Vertical Shaft)",
    raise_drill: "Raise Drilling (Raise Boring)",
    electrical: "Underground Electrical Systems Safety",
    mhsa: "MHSA 1996 Regulations",
    seismicity: "Seismicity & Rockbursts",
    blasting: "Blasting & Explosives",
    evacuation: "Emergency Evacuation",
    fire: "Fire Underground",
    tmm: "Trackless Mobile Machinery",
    winders: "WINDERS & HOISTING SYSTEMS"

};





const baseQuiz = {
    handover: {name:"SHIFT HANDOVER & PRE-CHECKS", q: [
        {q:"Who must attend shift handover?", o:["Only shift boss","All incoming and outgoing crew"], c:1},
        {q:"What must be signed before work starts?", o:["Nothing","Section 23 declaration"], c:1},
        {q:"Red tag on equipment means?", o:["Minor fault","Do not operate — locked out"], c:1},
        {q:"What gas is checked with methanometer?", o:["Oxygen","Methane"], c:1},
        {q:"Who signs Early Warning Device log?", o:["Anyone","Only shift boss"], c:1},
        {q:"Can you work without cap lamp?", o:["Yes","Never"], c:1},
        {q:"Refuge bay must contain?", o:["Water only","SCSRs, water, first aid, phone"], c:1},
        {q:"Who declares workplace safe?", o:["Any miner","Shift boss after inspection"], c:1},
        {q:"What is checked on LHD before use?", o:["Fuel only","Brakes, lights, horn, fire suppression"], c:1},
        {q:"What is a 'hot seat' changeover?", o:["Quick break","Driver change without stopping"], c:1},
        {q:"Who checks water dams?", o:["Anyone","Only designated person"], c:1},
        {q:"What is a TARP?", o:["Tool","Trigger Action Response Plan"], c:1},
        {q:"Can you start work with unsigned logbook?", o:["Yes","Never"], c:1},
        {q:"Who checks ventilation doors?", o:["Operator","Only ventilation officer"], c:1},
        {q:"What is a 'blind spot' check?", o:["Mirror","Physical walk-around"], c:1},
        {q:"Who must carry a gas monitor?", o:["Only supervisor","All underground personnel"], c:1},
        {q:"What is a 'lockout tagout'?", o:["Safety procedure","Equipment fault"], c:1},
        {q:"Can you work alone underground?", o:["Yes","Never"], c:1},
        {q:"What is a 'pre-use inspection'?", o:["Optional","Mandatory before operating equipment"], c:1},
        {q:"Who signs the refuge bay register?", o:["Anyone","Only shift boss"], c:1},
        {q:"What is a 'stop block'?", o:["Traffic control","Emergency brake"], c:1},
        {q:"What is a 'travelway inspection'?", o:["Daily walk","Only monthly"], c:1},
        {q:"Who checks fire extinguishers?", o:["Anyone","Only safety officer"], c:1},
        {q:"What is a 'code of practice'?", o:["Suggestion","Legal requirement"], c:1},
        {q:"Can you ignore a red tag?", o:["Yes","Never"], c:1}
    ]},
    lhd: {name:"LHD OPERATIONS", q: [
        {q:"Minimum clearance from moving LHD?", o:["1 metre","2 metres from any part"], c:1},
        {q:"Maximum speed in decline?", o:["25 km/h","15 km/h"], c:1},
        {q:"Bucket height when loaded?", o:["On ground","Max 400mm off ground"], c:1},
        {q:"Before reversing you must?", o:["Just look","Horn 3 times + check mirrors"], c:1},
        {q:"Can you ride in LHD bucket?", o:["Yes","Never"], c:1},
        {q:"Who may operate LHD?", o:["Anyone trained","Only competent certificate holder"], c:1},
        {q:"Seatbelt in LHD cab?", o:["Optional","Mandatory at all times"], c:1},
        {q:"Pedestrian near LHD must be?", o:["Within 1m","In refuge bay"], c:1},
        {q:"Fire on LHD — first action?", o:["Drive out","Activate suppression system"], c:1},
        {q:"What is a 'refuge bay'?", o:["Rest area","Safe waiting place"], c:1},
        {q:"Can you park LHD on incline?", o:["Yes","Only with brakes and chocks"], c:1},
        {q:"What is 'tramming'?", o:["Loading","Driving between points"], c:1},
        {q:"LHD lights must be?", o:["Optional","Working at all times"], c:1},
        {q:"Can you carry passengers in cab?", o:["Yes","Only with extra seat"], c:1},
        {q:"What is a 'tip'?", o:["Dumping point","Loading point"], c:1},
        {q:"LHD horn must be used?", o:["Never","When reversing and approaching"], c:1},
        {q:"What is a 'rollback'?", o:["Normal","Emergency brake failure"], c:1},
        {q:"Can you leave LHD running unattended?", o:["Yes","Never"], c:1},
        {q:"What is a 'load factor'?", o:["Speed","Weight capacity"], c:1},
        {q:"LHD must have?", o:["Radio","Two-way communication"], c:1},
        {q:"What is a 'haulage way'?", o:["Any road","Designated vehicle route"], c:1},
        {q:"Can you overtake another LHD?", o:["Yes","Only in designated areas"], c:1},
        {q:"What is a 'derailment'?", o:["Track issue","LHD off road"], c:1},
        {q:"LHD must stop at?", o:["Crossings","All intersections"], c:1},
        {q:"What is 'articulation lock'?", o:["Optional","Must be engaged when lifting"], c:1}
    ]},
    drill: {name:"JUMBO DRILLING", q: [
        {q:"Who may operate jumbo?", o:["Any miner","Only competent operator"], c:1},
        {q:"Mandatory PPE while drilling?", o:["Hard hat only","Ear plugs, dust mask, glasses"], c:1},
        {q:"Minimum distance from face while drilling?", o:["2m","5m behind operator"], c:1},
        {q:"Before charging holes you must?", o:["Just charge","Examine face + wash down"], c:1},
        {q:"Most common drilling accident?", o:["Noise","Flying rocks"], c:1},
        {q:"Water pressure for dust suppression?", o:["Any","Minimum 7 bar"], c:1},
        {q:"Can you drill with broken support?", o:["Yes","Never"], c:1},
        {q:"What is a 'boomer'?", o:["Drill type","Jumbo arm"], c:1},
        {q:"Who checks drill steels?", o:["Anyone","Only competent person"], c:1},
        {q:"What is a 'drifter'?", o:["Drill motor","Operator"], c:1},
        {q:"Can you drill without water?", o:["Yes","Never"], c:1},
        {q:"What is a 'face examination'?", o:["Visual check","Mandatory before drilling"], c:1},
        {q:"Who installs temporary support?", o:["Anyone","Only support team"], c:1},
        {q:"What is a 'muck pile'?", o:["Ore heap","Broken rock"], c:1},
        {q:"Can you leave jumbo running unattended?", o:["Yes","Never"], c:1},
        {q:"What is a 'stope'?", o:["Office","Mining face"], c:1},
        {q:"Who checks ventilation during drilling?", o:["Operator","Ventilation officer"], c:1},
        {q:"What is a 'round'?", o:["Shift","Set of holes"], c:1},
        {q:"Can you drill with loose rock?", o:["Yes","Never"], c:1},
        {q:"What is a 'burn cut'?", o:["Blasting pattern","Drilling pattern"], c:1},
        {q:"Who approves drilling plan?", o:["Shift boss","Rock Engineer"], c:1},
        {q:"What is a 'lifters'?", o:["Bottom holes","Top holes"], c:1},
        {q:"Can you drill without ear protection?", o:["Yes","Never"], c:1},
        {q:"What is a 'collar'?", o:["Hole start","Hole end"], c:1},
        {q:"Who marks holes?", o:["Anyone","Only surveyor"], c:1}
    ]},
    support: {name:"GROUND SUPPORT", q: [
        {q:"Can anyone enter unsupported ground?", o:["If quick","Never"], c:1},
        {q:"Minimum resin bolt length in UG2?", o:["1.8m","2.4m"], c:1},
        {q:"Mesh overlap between sheets?", o:["150mm","300mm"], c:1},
        {q:"Who installs tendon support?", o:["Any miner","Only certified team"], c:1},
        {q:"Maximum distance between bolts?", o:["2m","1.5m centres"], c:1},
        {q:"What is hangingwall rider?", o:["Ore type","Loose rock above support"], c:1},
        {q:"Temporary support before bolting?", o:["Optional","Mandatory"], c:1},
        {q:"What is a 'pack'?", o:["Waste rock wall","Support structure"], c:1},
        {q:"Who checks support installation?", o:["Anyone","Only rock engineer"], c:1},
        {q:"What is a 'tendon'?", o:["Long cable bolt","Short bolt"], c:1},
        {q:"Can you remove temporary support?", o:["Yes","Only after permanent installed"], c:1},
        {q:"What is a 'mat pack'?", o:["Timber pack","Waste rock pack"], c:1},
        {q:"Who approves support standard?", o:["Shift boss","Rock Engineer"], c:1},
        {q:"What is a 'yield zone'?", o:["Safe area","Area that moves"], c:1},
        {q:"Can you work under unsupported roof?", o:["Yes","Never"], c:1},
        {q:"What is a 'prop'?", o:["Hydraulic support","Timber pole"], c:1},
        {q:"Who installs mesh?", o:["Anyone","Only support team"], c:1},
        {q:"What is a 'strike'?", o:["Protest","Horizontal"], c:1},
        {q:"Can you use damaged bolts?", o:["Yes","Never"], c:1},
        {q:"What is a 'dip'?", o:["Angle down","Angle up"], c:1},
        {q:"Who checks bolt tension?", o:["Anyone","Only competent person"], c:1},
        {q:"What is a 'fault'?", o:["Rock break","Ore body"], c:1},
        {q:"Can you install support alone?", o:["Yes","Never"], c:1},
        {q:"What is a 'gully'?", o:["Drain","Mining cut"], c:1},
        {q:"Who records support installation?", o:["Anyone","Only shift boss"], c:1}
    ]},
    vent: {name:"VENTILATION FAILURE", q: [
        {q:"First action on main vent failure?", o:["Keep working","Stop → Refuge → Don SCSR"], c:1},
        {q:"Minimum SCSR duration?", o:["15 minutes","30 minutes"], c:1},
        {q:"Most dangerous gas in UG2?", o:["CO2","Methane"], c:1},
        {q:"Refuge bay must have?", o:["Water only","SCSRs, sealed door, phone"], c:1},
        {q:"How often are refuge bays inspected?", o:["Monthly","Weekly"], c:1},
        {q:"Can you remove SCSR mouthpiece?", o:["Yes","Never underground"], c:1},
        {q:"What is a 'booster fan'?", o:["Main fan","Auxiliary fan"], c:1},
        {q:"Who checks ventilation doors?", o:["Anyone","Only vent officer"], c:1},
        {q:"What is a 'regulator'?", o:["Door","Air control device"], c:1},
        {q:"Can you block ventilation?", o:["Yes","Never"], c:1},
        {q:"What is a 'scrubber'?", o:["Cleaner","Air cleaning device"], c:1},
        {q:"Who approves vent changes?", o:["Shift boss","Ventilation Engineer"], c:1},
        {q:"What is a 'column'?", o:["Air shaft","Support pillar"], c:1},
        {q:"Can you work without air?", o:["Yes","Never"], c:1},
        {q:"What is a 'bulkhead'?", o:["Wall","Air seal"], c:1},
        {q:"Who monitors air quality?", o:["Anyone","Ventilation officer"], c:1},
        {q:"What is a 'return airway'?", o:["Fresh air","Used air"], c:1},
        {q:"Can you open sealed doors?", o:["Yes","Only authorized"], c:1},
        {q:"What is a 'vent bag'?", o:["Ducting","Air duct"], c:1},
        {q:"Who checks fan operation?", o:["Anyone","Only electrician"], c:1},
        {q:"What is a 'short circuit'?", o:["Electrical fault","Air bypass"], c:1},
        {q:"Can you smoke underground?", o:["Yes","Never"], c:1},
        {q:"What is a 'laminar flow'?", o:["Smooth air","Turbulent air"], c:1},
        {q:"Who records air readings?", o:["Anyone","Only vent officer"], c:1},
        {q:"What is a 'ventilation plan'?", o:["Map","Legal requirement"], c:1}
    ]},
    rockfall: {name:"ROCKFALL EMERGENCY", q: [
        {q:"First action when rocks fall?", o:["Run","Stop → Drop → Cover head → Wait"], c:1},
        {q:"Who declares area safe after rockfall?", o:["Shift boss","Only Rock Engineer"], c:1},
        {q:"TARP Level 4 means?", o:["Minor spalling","Major rockburst/fall of ground"], c:1},
        {q:"Where do you go during rockfall?", o:["Under mesh","Nearest solid support/refuge"], c:1},
        {q:"Minimum wait before re-entry?", o:["10 minutes","Until declared safe"], c:1},
        {q:"Most common cause of fatalities?", o:["Blasting","Rockfalls"], c:1},
        {q:"What is a 'seismic event'?", o:["Earthquake","Rock stress release"], c:1},
        {q:"Who monitors seismicity?", o:["Anyone","Rock Engineer"], c:1},
        {q:"What is a 'pillar'?", o:["Support column","Ore block"], c:1},
        {q:"Can you work during seismic warning?", o:["Yes","Never"], c:1},
        {q:"What is a 'barney'?", o:["Scaling tool","Support check"], c:1},
        {q:"Who does scaling?", o:["Anyone","Only competent person"], c:1},
        {q:"What is a 'brow'?", o:["Face edge","Hangingwall"], c:1},
        {q:"Can you leave loose rock?", o:["Yes","Never"], c:1},
        {q:"What is a 'slip'?", o:["Fall","Joint plane"], c:1},
        {q:"Who checks ground conditions?", o:["Anyone","Only shift boss"], c:1},
        {q:"What is a 'wedge'?", o:["Support","Unstable block"], c:1},
        {q:"Can you drill under loose rock?", o:["Yes","Never"], c:1},
        {q:"What is a 'fault'?", o:["Ore body","Rock break"], c:1},
        {q:"Who approves re-entry after rockfall?", o:["Shift boss","Rock Engineer"], c:1},
        {q:"What is a 'closure'?", o:["Mine closing","Ground movement"], c:1},
        {q:"Can you ignore TARP?", o:["Yes","Never"], c:1},
        {q:"What is a 'seismograph'?", o:["Earthquake recorder","Rock movement monitor"], c:1},
        {q:"Who installs seismic sensors?", o:["Anyone","Only specialist"], c:1},
        {q:"What is a 'rockburst'?", o:["Explosion","Sudden rock failure"], c:1}
    ]},
    traffic: {name:"TRAFFIC MANAGEMENT", q: [
        {q:"Two vehicles in single lane?", o:["Race","Stop, call, establish right of way"], c:1},
        {q:"Who has right of way downhill?", o:["Loaded vehicle","Downhill vehicle"], c:1},
        {q:"Maximum vehicles in single lane?", o:["Two","One at a time"], c:1},
        {q:"Radio call sign for LHD?", o:["Any name","LHD + number"], c:1},
        {q:"Speed limit in crosscut?", o:["20 km/h","10 km/h"], c:1},
        {q:"Who controls traffic?", o:["Anyone","Traffic controller"], c:1},
        {q:"What is a 'stop block'?", o:["Traffic control","Emergency brake"], c:1},
        {q:"Can you overtake in decline?", o:["Yes","Never"], c:1},
        {q:"What is a 'refuge bay'?", o:["Rest area","Safe waiting place"], c:1},
        {q:"Who checks traffic signs?", o:["Anyone","Only safety officer"], c:1},
        {q:"What is a 'haulage'?", o:["Transport","Ore movement"], c:1},
        {q:"Can you walk in haulage way?", o:["Yes","Only in refuge"], c:1},
        {q:"What is a 'level'?", o:["Floor","Underground horizon"], c:1},
        {q:"Who approves traffic plan?", o:["Shift boss","Mine Manager"], c:1},
        {q:"What is 'tramming'?", o:["Loading","Driving"], c:1},
        {q:"Can you park in travelway?", o:["Yes","Only in designated area"], c:1},
        {q:"What is a 'derail'?", o:["Accident","Vehicle off track"], c:1},
        {q:"Who reports traffic incidents?", o:["Anyone","Operator"], c:1},
        {q:"What is a 'one-way'?", o:["Single direction","Traffic rule"], c:1},
        {q:"Can you use phone while driving?", o:["Yes","Never"], c:1},
        {q:"What is a 'traffic light'?", o:["Signal","Control device"], c:1},
        {q:"Who maintains traffic signs?", o:["Anyone","Only maintenance"], c:1},
        {q:"What is a 'clearance'?", o:["Space","Safe distance"], c:1},
        {q:"Can you reverse without guide?", o:["Yes","Never"], c:1},
        {q:"What is a 'haul road'?", o:["Any road","Designated route"], c:1}
    ]},
    reentry: {name:"RE-ENTRY AFTER BLAST", q: [
        {q:"Minimum wait after blast?", o:["15 minutes","30 minutes"], c:1},
        {q:"Who declares re-entry safe?", o:["Any miner","Blasting certificate holder + vent officer"], c:1},
        {q:"What must be checked before re-entry?", o:["Fumes only","Fumes, misfires, ground condition"], c:1},
        {q:"Can you remove barricade tape?", o:["Yes","Only authorized person"], c:1},
        {q:"Most common re-entry hazard?", o:["Dust","Misfires and NOx fumes"], c:1},
        {q:"What is a 'misfire'?", o:["Failed explosive","Unexploded charge"], c:1},
        {q:"Who checks for misfires?", o:["Anyone","Only blaster"], c:1},
        {q:"What is 'fume classification'?", o:["Smell test","Scientific measurement"], c:1},
        {q:"Can you enter with gas monitor?", o:["Optional","Mandatory"], c:1},
        {q:"What is a 'stemming'?", o:["Plug","Hole filler"], c:1},
        {q:"Who records blast details?", o:["Anyone","Only blaster"], c:1},
        {q:"What is a 'charging'?", o:["Loading holes","Firing"], c:1},
        {q:"Can you re-enter alone?", o:["Yes","Never"], c:1},
        {q:"What is a 'guard'?", o:["Security","Person at barricade"], c:1},
        {q:"Who approves re-entry time?", o:["Shift boss","Ventilation officer"], c:1},
        {q:"What is a 'blast clearance'?", o:["Permission","Safe to enter"], c:1},
        {q:"Can you smoke after blast?", o:["Yes","Never"], c:1},
        {q:"What is a 'primer'?", o:["Main explosive","Initiator"], c:1},
        {q:"Who checks ventilation after blast?", o:["Anyone","Vent officer"], c:1},
        {q:"What is a 'delay'?", o:["Time gap","Explosive type"], c:1},
        {q:"Can you remove misfire?", o:["Yes","Only blaster"], c:1},
        {q:"What is a 'firing line'?", o:["Cable","Blast circuit"], c:1},
        {q:"Who keeps blast register?", o:["Anyone","Only blaster"], c:1},
        {q:"What is a 'barricade'?", o:["Tape","Physical barrier"], c:1},
        {q:"Can you re-enter before clearance?", o:["Yes","Never"], c:1}
    ]},
    shaft_sinking: {name:"SHAFT SINKING SAFETY", q: [
        {q:"Who may ride the sinking stage?", o:["Any miner","Only certified shaft sinkers"], c:1},
        {q:"What is a 'kibble'?", o:["Tool box","Shaft bucket for men & material"], c:1},
        {q:"Shaft stage must have how many escape routes?", o:["One","Two independent ladders"], c:1},
        {q:"Maximum wind speed allowed during sinking?", o:["10 m/s","6 m/s"], c:1},
        {q:"Emergency bell signal in shaft?", o:["3 rings","7 rings repeated"], c:1},
        {q:"Most common fatality cause in shaft sinking?", o:["Blasting","Falling objects"], c:1},
        {q:"Shaft headgear must have?", o:["One winder","Two independent winders"], c:1},
        {q:"Who examines shaft before descent?", o:["Shift boss","Competent shaft examiner"], c:1},
        {q:"Concrete lining follows how far behind face?", o:["50m","Max 30m"], c:1},
        {q:"Shaft sinking is classified as?", o:["Normal work","Highest risk activity"], c:1},
        {q:"What is a 'stage'?", o:["Platform","Work level"], c:1},
        {q:"Who operates the winder?", o:["Anyone","Only competent winder driver"], c:1},
        {q:"What is a 'headgear'?", o:["Helmet","Shaft top structure"], c:1},
        {q:"Can you overload kibble?", o:["Yes","Never"], c:1},
        {q:"What is a 'bank'?", o:["Surface level","Shaft top"], c:1},
        {q:"Who checks shaft guides?", o:["Anyone","Only rigger"], c:1},
        {q:"What is a 'bunton'?", o:["Beam","Shaft divider"], c:1},
        {q:"Can you descend during blasting?", o:["Yes","Never"], c:1},
        {q:"What is a 'sinking cut'?", o:["Blast pattern","Excavation"], c:1},
        {q:"Who approves shaft plan?", o:["Shift boss","Mine Manager"], c:1},
        {q:"What is a 'shaft barrel'?", o:["Cylinder","Shaft lining"], c:1},
        {q:"Can you work without harness?", o:["Yes","Never"], c:1},
        {q:"What is a 'collar'?", o:["Top","Shaft entrance"], c:1},
        {q:"Who records shaft depth?", o:["Anyone","Only surveyor"], c:1},
        {q:"What is a 'sump'?", o:["Bottom","Water collection"], c:1}
    ]},
    raise_drill: {name:"RAISE DRILLING SAFETY", q: [
        {q:"Can personnel be underground during reaming?", o:["Yes, if far away","Never — full evacuation"], c:1},
        {q:"Biggest risk in raise drilling?", o:["Noise","Reamer breakout into occupied area"], c:1},
        {q:"Pilot hole deviation limit?", o:["1 in 50","1 in 100"], c:1},
        {q:"Before reaming, what must be installed?", o:["Nothing","Blast-proof bulkhead + sirens"], c:1},
        {q:"Minimum distance from active stope?", o:["100m","200m horizontal"], c:1},
        {q:"Who approves raise drilling plan?", o:["Shift boss","Rock Engineer + Mine Manager"], c:1},
        {q:"Raise bore hole when not in use must be?", o:["Open","Covered with steel plate"], c:1},
        {q:"What is 'back reaming'?", o:["Drilling down","Drilling upward from bottom"], c:1},
        {q:"Raise bore ventilation requirement?", o:["0.3 m/s","0.06 m³/s per kW"], c:1},
        {q:"Raise drilling requires?", o:["Normal permit","Special high-risk permit"], c:1},
        {q:"What is a 'reamer'?", o:["Drill bit","Large cutter"], c:1},
        {q:"Who operates raise drill?", o:["Anyone","Only competent operator"], c:1},
        {q:"What is a 'pilot hole'?", o:["Small hole","Guide hole"], c:1},
        {q:"Can you stand under raise bore?", o:["Yes","Never"], c:1},
        {q:"What is a 'breakout'?", o:["Success","Reamer exit"], c:1},
        {q:"Who checks reamer path?", o:["Anyone","Only surveyor"], c:1},
        {q:"What is a 'raise'?", o:["Vertical hole","Ore pass"], c:1},
        {q:"Can you drill without survey?", o:["Yes","Never"], c:1},
        {q:"What is a 'collar pipe'?", o:["Top casing","Protection"], c:1},
        {q:"Who installs bulkhead?", o:["Anyone","Only specialist"], c:1},
        {q:"What is a 'raise borer'?", o:["Machine","Drill rig"], c:1},
        {q:"Can you work during reaming?", o:["Yes","Never"], c:1},
        {q:"What is a 'vent shaft'?", o:["Airway","Raise bore"], c:1},
        {q:"Who monitors progress?", o:["Anyone","Only engineer"], c:1},
        {q:"What is a 'deviation'?", o:["Error","Hole drift"], c:1}
    ]},
    seismicity: {name:"SEISMICITY & ROCKBURSTS", q: [
        {q:"What causes a rockburst?", o:["Blasting","Sudden release of stored energy"], c:1},
        {q:"Who monitors seismic activity?", o:["Anyone","Rock Engineering department"], c:1},
        {q:"What is a 'TARP Level 5'?", o:["Minor event","Catastrophic rockburst"], c:1},
        {q:"Can you work during seismic warning?", o:["Yes","Never"], c:1},
        {q:"What is a 'seismic net'?", o:["Internet","Support mesh"], c:1},
        {q:"Who approves re-entry after seismic event?", o:["Shift boss","Rock Engineer"], c:1},
        {q:"What is a 'closure meter'?", o:["Time device","Ground movement monitor"], c:1},
        {q:"Can you ignore seismic alarm?", o:["Yes","Never"], c:1},
        {q:"What is a 'yield pillar'?", o:["Strong pillar","Designed to crush"], c:1},
        {q:"Who installs seismic sensors?", o:["Anyone","Only specialist"], c:1},
        {q:"What is a 'microseismic event'?", o:["Small quake","Less than 0.1 magnitude"], c:1},
        {q:"Can you drill during high seismicity?", o:["Yes","Only with approval"], c:1},
        {q:"What is a 'destress blast'?", o:["Normal blast","Reduce stress"], c:1},
        {q:"Who declares seismic risk level?", o:["Shift boss","Rock Engineer"], c:1},
        {q:"What is a 'bracket pillar'?", o:["Support","Left for stability"], c:1},
        {q:"Can you work in high-risk zone?", o:["Yes","Only with permit"], c:1},
        {q:"What is a 'seismic hazard map'?", o:["Mine map","Risk zones"], c:1},
        {q:"Who checks seismic data daily?", o:["Anyone","Rock Engineer"], c:1},
        {q:"What is a 'rock noise'?", o:["Sound","Stress indicator"], c:1},
        {q:"Can you ignore rock noise?", o:["Yes","Never"], c:1},
        {q:"What is a 'seismic station'?", o:["Office","Monitoring point"], c:1},
        {q:"Who calibrates seismic system?", o:["Anyone","Only specialist"], c:1},
        {q:"What is a 'trigger level'?", o:["Alarm point","Set magnitude"], c:1},
        {q:"Can you enter after rockburst?", o:["Yes","Only after examination"], c:1},
        {q:"What is a 'seismic code'?", o:["Secret","Emergency procedure"], c:1}
    ]},
    blasting: {name:"BLASTING & EXPLOSIVES", q: [
        {q:"Who may handle explosives?", o:["Any miner","Only competent blaster"], c:1},
        {q:"Minimum age for blasting certificate?", o:["18","21"], c:1},
        {q:"What is a 'priming'?", o:["First charge","Initiator placement"], c:1},
        {q:"Can you store explosives underground?", o:["Yes","Only in approved magazine"], c:1},
        {q:"What is a 'misfire'?", o:["Failed blast","Unexploded charge"], c:1},
        {q:"Who investigates misfires?", o:["Anyone","Only blaster"], c:1},
        {q:"What is 'ANFO'?", o:["Explosive type","Ammonium Nitrate Fuel Oil"], c:1},
        {q:"Can you smoke near explosives?", o:["Yes","Never"], c:1},
        {q:"What is a 'booster'?", o:["Main charge","High explosive"], c:1},
        {q:"Who signs blasting register?", o:["Anyone","Only blaster"], c:1},
        {q:"What is a 'shock tube'?", o:["Detonator","Non-electric"], c:1},
        {q:"Can you mix explosives?", o:["Yes","Only authorized"], c:1},
        {q:"What is a 'stemming'?", o:["Plug","Hole filler"], c:1},
        {q:"Who checks blast clearance?", o:["Anyone","Blasting officer"], c:1},
        {q:"What is a 'delay detonator'?", o:["Instant","Timed"], c:1},
        {q:"Can you blast without permit?", o:["Yes","Never"], c:1},
        {q:"What is a 'magazine'?", o:["Store","Explosives storage"], c:1},
        {q:"Who transports explosives?", o:["Anyone","Only licensed"], c:1},
        {q:"What is a 'firing line'?", o:["Cable","Blast circuit"], c:1},
        {q:"Can you re-use detonators?", o:["Yes","Never"], c:1},
        {q:"What is a 'blast guard'?", o:["Security","Person at barricade"], c:1},
        {q:"Who records blast details?", o:["Anyone","Only blaster"], c:1},
        {q:"What is a 'face advance'?", o:["Progress","Blast result"], c:1},
        {q:"Can you blast in fault zone?", o:["Yes","Only with approval"], c:1},
        {q:"What is a 'blast pattern'?", o:["Random","Designed holes"], c:1}
    ]},
    evacuation: {name:"EMERGENCY EVACUATION", q: [
        {q:"What is the emergency signal?", o:["Siren","7 bells repeated"], c:1},
        {q:"Where do you go on evacuation?", o:["Surface","Nearest refuge bay"], c:1},
        {q:"Who leads evacuation?", o:["Anyone","Shift boss"], c:1},
        {q:"Can you use main shaft?", o:["Yes","Only if safe"], c:1},
        {q:"What is a 'stink damp'?", o:["Smell","CO after fire"], c:1},
        {q:"Who checks headcount?", o:["Anyone","Safety officer"], c:1},
        {q:"What is a 'self-rescuer'?", o:["SCSR","Breathing device"], c:1},
        {q:"Can you run during evacuation?", o:["Yes","No - walk fast"], c:1},
        {q:"What is a 'refuge bay'?", o:["Rest area","Sealed safe room"], c:1},
        {q:"Who activates emergency plan?", o:["Anyone","Proto team"], c:1},
        {q:"What is a 'proto team'?", o:["Rescue team","Trained rescuers"], c:1},
        {q:"Can you go back for tools?", o:["Yes","Never"], c:1},
        {q:"What is a 'cascade system'?", o:["Air supply","Oxygen delivery"], c:1},
        {q:"Who carries extra SCSR?", o:["Anyone","Team leader"], c:1},
        {q:"What is a 'tag board'?", o:["Notice board","Headcount system"], c:1},
        {q:"Can you use lift during fire?", o:["Yes","Never"], c:1},
        {q:"What is a 'fire round'?", o:["Blasting","Emergency blast"], c:1},
        {q:"Who declares all clear?", o:["Shift boss","Mine Manager"], c:1},
        {q:"What is a 'smoke helmet'?", o:["Old device","Breathing apparatus"], c:1},
        {q:"Can you evacuate alone?", o:["Yes","Never"], c:1},
        {q:"What is a 'secondary exit'?", o:["Back door","Escape route"], c:1},
        {q:"Who trains evacuation?", o:["Anyone","Safety department"], c:1},
        {q:"What is a 'muster point'?", o:["Meeting place","Assembly area"], c:1},
        {q:"Can you drive during evacuation?", o:["Yes","Only authorized"], c:1},
        {q:"What is a 'roll call'?", o:["Attendance","Headcount"], c:1}
    ]},
    fire: {name:"FIRE UNDERGROUND", q: [
        {q:"First action on fire?", o:["Fight it","Activate alarm + evacuate"], c:1},
        {q:"What is a 'fire triangle'?", o:["Shape","Fuel, oxygen, heat"], c:1},
        {q:"Can you use water on electrical fire?", o:["Yes","Never"], c:1},
        {q:"Who fights underground fires?", o:["Anyone","Only proto team"], c:1},
        {q:"What is a 'fire door'?", o:["Normal door","Sealed fire barrier"], c:1},
        {q:"Can you open fire doors?", o:["Yes","Only during emergency"], c:1},
        {q:"What is a 'smoke inhalation'?", o:["Minor","Leading cause of death"], c:1},
        {q:"Who declares fire emergency?", o:["Anyone","Shift boss"], c:1},
        {q:"What is a 'fire round'?", o:["Blasting","Emergency blast"], c:1},
        {q:"Can you re-enter after fire?", o:["Yes","Only after examination"], c:1},
        {q:"What is a 'CO monitor'?", o:["Gas detector","Carbon monoxide"], c:1},
        {q:"Who checks fire extinguishers?", o:["Anyone","Only safety officer"], c:1},
        {q:"What is a 'fire suppression system'?", o:["Water","Automatic on vehicles"], c:1},
        {q:"Can you store diesel underground?", o:["Yes","Only in approved tanks"], c:1},
        {q:"What is a 'hot work permit'?", o:["Welding permit","Required for cutting"], c:1},
        {q:"Who approves hot work?", o:["Anyone","Safety officer"], c:1},
        {q:"What is a 'fire watch'?", o:["Observer","Person monitoring"], c:1},
        {q:"Can you smoke underground?", o:["Yes","Never"], c:1},
        {q:"What is a 'fire damper'?", o:["Valve","Air control"], c:1},
        {q:"Who trains fire fighting?", o:["Anyone","Proto team"], c:1},
        {q:"What is a 'fire break'?", o:["Gap","Sealed area"], c:1},
        {q:"Can you use foam on oil fire?", o:["Yes","Only Class B"], c:1},
        {q:"What is a 'fire load'?", o:["Heat","Fuel amount"], c:1},
        {q:"Who records fire incidents?", o:["Anyone","Safety department"], c:1},
        {q:"What is a 'fire drill'?", o:["Practice","Mandatory monthly"], c:1}
    ]},
    tmm: {name:"TRACKLESS MOBILE MACHINERY", q: [
        {q:"What is TMM?", o:["Any vehicle","Trackless Mobile Machinery"], c:1},
        {q:"Who may operate TMM?", o:["Anyone trained","Only competent operator"], c:1},
        {q:"What is a 'collision avoidance system'?", o:["Optional","Mandatory on new TMM"], c:1},
        {q:"Can you reverse without guide?", o:["Yes","Only with camera"], c:1},
        {q:"What is a 'proximity detection'?", o:["Radar","Personnel warning"], c:1},
        {q:"Who checks TMM daily?", o:["Anyone","Operator"], c:1},
        {q:"What is a 'rollover protection'?", o:["ROPS","Safety cage"], c:1},
        {q:"Can you carry passengers?", o:["Yes","Only in designated seats"], c:1},
        {q:"What is a 'brake test'?", o:["Daily check","Mandatory"], c:1},
        {q:"Who approves TMM modifications?", o:["Anyone","Engineering"], c:1},
        {q:"What is a 'load haul dumper'?", o:["LHD","Ore carrier"], c:1},
        {q:"Can you exceed speed limit?", o:["Yes","Never"], c:1},
        {q:"What is a 'traffic management plan'?", o:["Map","Legal requirement"], c:1},
        {q:"Who trains TMM operators?", o:["Anyone","Only accredited"], c:1},
        {q:"What is a 'derailment'?", o:["Accident","Off road"], c:1},
        {q:"Can you park on incline?", o:["Yes","Only with chocks"], c:1},
        {q:"What is a 'light vehicle'?", o:["Bakkie","Underground utility"], c:1},
        {q:"Who checks TMM lights?", o:["Anyone","Operator"], c:1},
        {q:"What is a 'fatigue monitor'?", o:["Camera","Driver alertness"], c:1},
        {q:"Can you use phone while driving?", o:["Yes","Never"], c:1},
        {q:"What is a 'TMM register'?", o:["List","All machines"], c:1},
        {q:"Who reports TMM incidents?", o:["Anyone","Operator"], c:1},
        {q:"What is a 'service brake'?", o:["Main brake","Emergency brake"], c:1},
        {q:"Can you modify TMM?", o:["Yes","Only with approval"], c:1},
        {q:"What is a 'TMM code of practice'?", o:["Guideline","Legal document"], c:1}
    ]},
    winders: {name:"WINDERS & HOISTING SYSTEMS", q: [
        {q:"Who may operate a mine winder?", o:["Any driver","Only competent winder driver"], c:1},
        {q:"What is the emergency stop signal?", o:["3 bells","7 bells repeated"], c:1},
        {q:"What is a 'double drum winder'?", o:["Two ropes","Two drums"], c:1},
        {q:"Who checks the rope condition daily?", o:["Anyone","Only winder driver"], c:1},
        {q:"What is a 'lily controller'?", o:["Speed control","Safety device"], c:1},
        {q:"Can you ride the kibble?", o:["Yes","Only authorized personnel"], c:1},
        {q:"What is a 'safety catch'?", o:["Brake","Emergency arrestor"], c:1},
        {q:"Who approves winder modifications?", o:["Shift boss","Mechanical Engineer"], c:1},
        {q:"What is a 'rope test'?", o:["Pull test","Non-destructive"], c:1},
        {q:"Can you overload the cage?", o:["Yes","Never"], c:1},
        {q:"What is a 'headgear'?", o:["Helmet","Shaft top structure"], c:1},
        {q:"Who checks brakes before shift?", o:["Anyone","Winder driver"], c:1},
        {q:"What is a 'suicide circuit'?", o:["Emergency stop","Field reversal"], c:1},
        {q:"Can you talk on phone in winder house?", o:["Yes","Never"], c:1},
        {q:"What is a 'depth indicator'?", o:["Gauge","Position display"], c:1},
        {q:"Who records winder logbook?", o:["Anyone","Only driver"], c:1},
        {q:"What is a 'slack rope'?", o:["Normal","Dangerous condition"], c:1},
        {q:"Can you wind during storm?", o:["Yes","Only if safe"], c:1},
        {q:"What is a 'cage gate interlock'?", o:["Safety switch","Prevents movement"], c:1},
        {q:"Who tests emergency brakes?", o:["Anyone","Only weekly by driver"], c:1},
        {q:"What is a 'winder house'?", o:["Office","Control room"], c:1},
        {q:"Can you leave winder unattended?", o:["Yes","Never"], c:1},
        {q:"What is a 'drum brake'?", o:["Main brake","Emergency brake"], c:1},
        {q:"Who calibrates depth indicator?", o:["Anyone","Only specialist"], c:1},
        {q:"What is a 'man-winding'?", o:["Material only","Personnel transport"], c:1}
    ]},

electrical: {name:"UNDERGROUND ELECTRICAL SAFETY", q: [
        {q:"Who may perform work on electrical apparatus?", o:["Any miner","Only competent authorized person"], c:1},
        {q:"What is the main hazard of trailing cables?", o:["Tripping","Damage leading to shock or fire"], c:1},
        {q:"Can you work on live electrical equipment?", o:["Yes, if quick","Never, must be isolated"], c:1},
        {q:"What must be done before working on electrical machinery?", o:["Nothing","Lockout and tagout"], c:1},
        {q:"Flameproof equipment is required underground to prevent?", o:["Dust","Ignition of methane"], c:1},
        {q:"What is an arc flash?", o:["Short circuit","Uncontrolled electrical discharge"], c:1},
        {q:"Helmet light assemblies must comply with?", o:["Any standard","SANS 1438"], c:1},
        {q:"Who approves electrical reticulation design?", o:["Shift boss","Competent professional engineer"], c:1},
        {q:"Trailing cables must be protected from?", o:["Dust only","Mechanical damage"], c:1},
        {q:"What gas is produced when charging batteries?", o:["Oxygen","Hydrogen"], c:1},
        {q:"Battery charging stations must have?", o:["Nothing special","Ventilation and no smoking"], c:1},
        {q:"Can water be used on electrical fires?", o:["Always","No, use dry extinguisher"], c:1},
        {q:"What is required for portable electrical tools underground?", o:["Normal plugs","Flameproof and earth leakage"], c:1},
        {q:"Earth leakage protection is mandatory on?", o:["High voltage only","All electrical apparatus"], c:1},
        {q:"Who tests electrical installations?", o:["Anyone","Competent person"], c:1},
        {q:"Overhead power lines underground must have?", o:["No protection","Guards or barriers"], c:1},
        {q:"What is a 'competent person' for electrical work?", o:["Trained miner","Registered and experienced"], c:1},
        {q:"Can flexible cables be repaired with tape?", o:["Yes","Only with proper vulcanizing"], c:1},
        {q:"What causes most electrical accidents underground?", o:["Water","Improper isolation"], c:1},
        {q:"Substations underground must be?", o:["Open","Enclosed and locked"], c:1},
        {q:"What is the purpose of earthing?", o:["Grounding current","Prevent shock"], c:1},
        {q:"Can you overload electrical circuits?", o:["Yes","Never"], c:1},
        {q:"Portable transformers must be?", o:["Any type","Flameproof"], c:1},
        {q:"What is required after electrical maintenance?", o:["Nothing","Testing and certification"], c:1},
        {q:"Electrical tools must be inspected?", o:["Monthly","Before each use"], c:1},
        {q:"What is a 'dead' circuit?", o:["Switched off","Tested and proven no voltage"], c:1},
        {q:"Who issues permit to work on electrical?", o:["Supervisor","Authorized person"], c:1},
        {q:"Cable joints underground must be?", o:["Taped","Flameproof"], c:1},
        {q:"What is the risk of damaged insulation?", o:["Minor","Electric shock"], c:1},
        {q:"Lightning arrestors are required on?", o:["Surface only","Surface power lines"], c:1},
        {q:"Can non-flameproof equipment be used underground?", o:["Yes","Never"], c:1},
        {q:"What must be displayed on electrical panels?", o:["Nothing","Warnings and ratings"], c:1},
        {q:"Electrical records must be kept for?", o:["1 year","As required by COP"], c:1},
        {q:"Who reports electrical defects?", o:["Only electrician","All employees"], c:1},
        {q:"What is 'intrinsically safe' equipment?", o:["Low power","Cannot cause ignition"], c:1},
        {q:"Power must be isolated during?", o:["Blasting","Blasting nearby"], c:1},
        {q:"What is a 'switch handle lock' for?", o:["Security","Lockout"], c:1},
        {q:"Can you touch exposed wires?", o:["If insulated","Never"], c:1},
        {q:"Electrical safety is part of?", o:["Optional training","Mandatory induction"], c:1},
        {q:"What is the voltage limit for handheld tools?", o:["220V","110V or less"], c:1},
        {q:"Cables must not lie in?", o:["Dry areas","Water"], c:1},
        {q:"Who approves electrical COP?", o:["Manager","Inspector"], c:1},
        {q:"Electrical fires produce?", o:["Smoke only","Toxic fumes"], c:1},
        {q:"What is 'double insulation'?", o:["Extra protection","No earth needed"], c:1},
        {q:"Can you use damaged plugs?", o:["Yes","Never"], c:1},
        {q:"Electrical apparatus must be examined?", o:["Annually","Regularly as per plan"], c:1},
        {q:"What is a 'ground fault'?", o:["Normal","Leakage to earth"], c:1},
        {q:"All electrical work requires?", o:["Nothing","Risk assessment"], c:1},
        {q:"Who trains electrical workers?", o:["Anyone","Accredited"], c:1},
        {q:"Electrical safety rules are in?", o:["MHSA only","Chapter 3 regulations"], c:1}
    ]},

    mhsa: {name:"MHSA 1996 REGULATIONS", q: [
        {q:"What is the main purpose of MHSA 1996?", o:["Production","Health and safety of miners"], c:1},
        {q:"Who must ensure safety at the mine?", o:["Employees","Employer"], c:1},
        {q:"Can employees refuse dangerous work?", o:["No","Yes, right to leave"], c:1},
        {q:"Who appoints the mine manager?", o:["Inspector","Employer"], c:1},
        {q:"What must employer provide for training?", o:["Nothing","Health and safety training"], c:1},
        {q:"Employees must report?", o:["Production","Unsafe conditions"], c:1},
        {q:"What is a health and safety representative?", o:["Supervisor","Elected employee"], c:1},
        {q:"Can employer charge for PPE?", o:["Yes","No"], c:1},
        {q:"What is the role of MHSC?", o:["Production","Advise on health and safety"], c:1},
        {q:"Employer must prepare?", o:["Nothing","Code of Practice"], c:1},
        {q:"Who conducts inquiries into accidents?", o:["Employer only","Inspector"], c:1},
        {q:"What is tripartite structure?", o:["One party","Government, employer, unions"], c:1},
        {q:"Juveniles underground prohibited under?", o:["18","Specific age"], c:1},
        {q:"Employer must conduct?", o:["Risk assessments","Risk assessments"], c:1},
        {q:"What is mandatory COP for?", o:["All hazards","Significant risks"], c:1},
        {q:"Employees must cooperate with?", o:["Production","Safety duties"], c:1},
        {q:"What is the right to withdraw?", o:["For pay","Dangerous place"], c:1},
        {q:"Who pays health and safety reps?", o:["Union","Employer"], c:1},
        {q:"Medical surveillance is?", o:["Optional","Mandatory"], c:1},
        {q:"What is the inspectorate for?", o:["Enforcement","Enforcement"], c:1},
        {q:"Offences under MHSA can lead to?", o:["Warning","Fines or imprisonment"], c:1},
        {q:"Employer must supply?", o:["Tools only","PPE free"], c:1},
        {q:"What is occupational hygiene?", o:["Cleaning","Measuring hazards"], c:1},
        {q:"Who establishes MQA?", o:["MHSA","MHSA"], c:1},
        {q:"Employees must take care of?", o:["Production","Own and others safety"], c:1},
        {q:"What is a serious injury?", o:["Minor","Reportable"], c:1},
        {q:"Employer must investigate?", o:["All incidents","Accidents"], c:1},
        {q:"What is the annual report for?", o:["Production","Health and safety"], c:1},
        {q:"No discrimination for?", o:["Reporting hazards","Reporting hazards"], c:1},
        {q:"What is a refuge bay?", o:["Rest area","Emergency shelter"], c:1},
        {q:"Ventilation is regulated under?", o:["MHSA","MHSA"], c:1},
        {q:"Who approves plans?", o:["Manager","Inspector"], c:1},
        {q:"What is lead exposure limit?", o:["None","Regulated"], c:1},
        {q:"Noise limits are?", o:["100 dB","Regulated"], c:1},
        {q:"What is the duty of CEO?", o:["None","Overall responsibility"], c:1},
        {q:"Health and safety committees are?", o:["Optional","Mandatory"], c:1},
        {q:"What is exit from mine?", o:["One way","Multiple"], c:1},
        {q:"Emergency procedures must be?", o:["Written","Practiced"], c:1},
        {q:"Who can stop operations?", o:["Only manager","Inspector"], c:1},
        {q:"What is hazardous substance?", o:["All chemicals","Defined"], c:1},
        {q:"Training records must be kept?", o:["No","Yes"], c:1},
        {q:"What is the role of unions?", o:["Production","Safety input"], c:1},
        {q:"MHSA applies to?", o:["Surface only","All mines"], c:1},
        {q:"What is risk management?", o:["Optional","Mandatory"], c:1},
        {q:"Employees must use?", o:["Tools","PPE correctly"], c:1},
        {q:"What is investigation report?", o:["Internal","Submitted to inspector"], c:1},
        {q:"Penalties for non-compliance?", o:["Minor","Severe"], c:1},
        {q:"What is continuous risk assessment?", o:["Once","Ongoing"], c:1},
        {q:"Employer must monitor?", o:["Production","Health"], c:1},
        {q:"What is the MHSA objective?", o:["Profit","Zero harm"], c:1}
    ]}
    
};

// Persistent scores stored in localStorage
let scores = JSON.parse(localStorage.getItem('miningSafetyScores') || '{}');
let quizStartTime = 0;

const moduleKeys = [
    "handover","lhd","drill","support","vent","rockfall","traffic","reentry",
    "shaft_sinking","raise_drill","seismicity","blasting","evacuation","fire","tmm","winders","electrical","mhsa"
];

function renderModuleGrid() {
    const grid = document.getElementById('moduleGrid');
    grid.innerHTML = '';
    moduleKeys.forEach(key => {
        const btn = document.createElement('div');
        btn.className = 'module-btn' + (['seismicity','blasting','evacuation','fire','tmm','winders'].includes(key) ? ' module-advanced' : '');
        btn.setAttribute('data-module', key);
        btn.textContent = key === 'shaft_sinking' ? 'Shaft Sinking' :
                         key === 'raise_drill' ? 'Raise Drilling' :
                         key === 'winders' ? 'WINDERS & HOISTING' :
                         key.split('_').map(w => w.charAt(0).toUpperCase() + w.slice(1)).join(' ');
        
        // Add score badge if completed
        if (scores[key]) {
            const badge = document.createElement('div');
            badge.className = 'score-badge ' + (scores[key].passed ? 'passed' : 'failed');
            badge.textContent = scores[key].percentage + '%';
            btn.appendChild(badge);
        }
        
        grid.appendChild(btn);
    });
    
    updateSidebarSummary();
}

function updateSidebarSummary() {
    const completed = Object.keys(scores).length;
    const passedCount = Object.values(scores).filter(s => s.passed).length;
    document.getElementById('completedCount').textContent = completed;
    document.getElementById('overallPass').textContent = completed > 0 ? Math.round((passedCount / completed) * 100) + '%' : '0%';
}

let current = '';
let qi = 0;
let correct = 0;
let currentQuiz = null;

function getShuffledQuiz(moduleKey) {
    const base = baseQuiz[moduleKey];
    if (!base) return {q: []};
    
    const shuffled = {name: base.name, q: []};
    
    base.q.forEach(origQ => {
        const options = [...origQ.o];
        const correctAnswer = options[origQ.c];
        for (let i = options.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [options[i], options[j]] = [options[j], options[i]];
        }
        const newC = options.indexOf(correctAnswer);
        shuffled.q.push({q: origQ.q, o: options, c: newC});
    });
    
    return shuffled;
}

document.getElementById('moduleGrid').addEventListener('click', function(e) {
    const btn = e.target.closest('.module-btn');
    if (btn) {
        const module = btn.getAttribute('data-module');
        selectModule(module);
    }
});

function selectModule(module) {
    document.getElementById('welcome').style.display = 'none';
    document.getElementById('moduleView').style.display = 'none';
    document.getElementById('videoArea').style.display = 'none';
    document.getElementById('quizPanel').style.display = 'none';
    document.getElementById('result').classList.add('d-none');
    document.getElementById('videoPlayer').src = '';

    current = module;
    document.getElementById('moduleView').style.display = 'block';
    document.getElementById('moduleTitle').textContent = moduleNames[module];
    document.getElementById('eventLog').innerHTML = `<strong>EVENT:</strong> ${moduleNames[module]} selected`;
}

function playVideo() {
    document.getElementById('moduleView').style.display = 'none';
    document.getElementById('videoArea').style.display = 'flex';
    document.getElementById('videoPlayer').src = videos[current] + "&enablejsapi=1";
}

function startTest() {
    document.getElementById('moduleView').style.display = 'none';
    document.getElementById('videoArea').style.display = 'none';
    
    currentQuiz = getShuffledQuiz(current);
    qi = 0; 
    correct = 0;
    quizStartTime = Date.now();
    
    startQuiz();
}

function startQuiz() {
    document.getElementById('quizPanel').style.display = 'block';
    
    if (currentQuiz.q.length === 0) {
        alert('Quiz not available for this module yet.');
        backToModules();
        return;
    }
    showQuestion();
}

function showQuestion() {
    const question = currentQuiz.q[qi];
    document.getElementById('qtext').textContent = question.q;
    const opts = document.getElementById('opts');
    opts.innerHTML = '';
    question.o.forEach((opt, i) => {
        const btn = document.createElement('button');
        btn.className = 'quiz-btn';
        btn.textContent = opt;
        btn.onclick = () => checkAns(i === question.c);
        opts.appendChild(btn);
    });
    document.getElementById('fb').innerHTML = '';
    document.getElementById('nextQ').style.display = 'none';
}

function checkAns(isCorrect) {
    if(isCorrect) correct++;
    document.getElementById('fb').innerHTML = isCorrect ?
        '<span style="color:#00ff00">CORRECT</span>' :
        '<span style="color:#ff0066">INCORRECT</span>';
    document.getElementById('nextQ').style.display = 'block';
    document.querySelectorAll('.quiz-btn').forEach(b => b.disabled = true);
}

function nextQ() {
    qi++;
    if(qi < currentQuiz.q.length) {
        showQuestion();
    } else {
        showFinalResult();
    }
}

function showFinalResult() {
    const total = currentQuiz.q.length;
    const percentage = Math.round((correct / total) * 100);
    const passed = correct >= Math.ceil(total * 0.8);
    const timeTaken = Math.floor((Date.now() - quizStartTime) / 1000);
    const mins = Math.floor(timeTaken / 60).toString().padStart(2, '0');
    const secs = (timeTaken % 60).toString().padStart(2, '0');

    // Save score
    scores[current] = {
        score: correct,
        total: total,
        percentage: percentage,
        passed: passed,
        timestamp: new Date().toISOString(),
        timeTaken: timeTaken
    };
    localStorage.setItem('miningSafetyScores', JSON.stringify(scores));

    // Update result screen
    document.getElementById('resultText').innerHTML = passed ?
        '<span style="color:#00ff00">COMPETENT — CLEARED FOR WORK</span>' :
        '<span style="color:#ff0066">RE-TRAINING REQUIRED</span>';
    
    document.getElementById('resultScore').textContent = `${correct}/${total} (${percentage}%)`;
    document.getElementById('progressFill').style.width = percentage + '%';
    document.getElementById('timeTaken').textContent = `${mins}:${secs}`;
    document.getElementById('questionsTotal').textContent = total;
    document.getElementById('correctAnswers').textContent = correct;
    document.getElementById('accuracy').textContent = percentage + '%';
    document.getElementById('passMessage').textContent = passed ?
        'Excellent work! You have demonstrated competency in this critical safety module.' :
        'You need at least 80% to pass. Please review the training video and try again.';

    document.getElementById('quizPanel').style.display = 'none';
    document.getElementById('result').classList.remove('d-none');

    // Update module grid and sidebar
    renderModuleGrid();
}

function retakeTest() {
    document.getElementById('result').classList.add('d-none');
    startTest(); // Fresh shuffle and timer
}

function backToModules() {
    document.getElementById('result').classList.add('d-none');
    document.getElementById('welcome').style.display = 'block';
    current = '';
    document.getElementById('videoPlayer').src = '';
}

// Initialize grid on load
renderModuleGrid();

// YouTube API remains the same
let player;
const tag = document.createElement('script');
tag.src = "https://www.youtube.com/iframe_api";
const firstScript = document.getElementsByTagName('script')[0];
firstScript.parentNode.insertBefore(tag, firstScript);

function onYouTubeIframeAPIReady() {
    player = new YT.Player('videoPlayer', {
        events: { 'onStateChange': e => { if (e.data === 0) startTest(); } }
    });
}
</script>
</body>
</html>






